---
tags:
    - 研究メモ
---

# 基礎知識
## 制御工学
極：伝達関数の分母多項式の根

ゼロ点：伝達関数の分子多項式の根

***

## bare metal
オペレーティングシステムを解さずに、ロジックハードウェア上で直接命令を実行するコンピュータをさす

***

## LSI常識設計
DC解析 - 全ての電圧・電流源を一定に保った場合の最終値(容量はオープン(0F), インダクタはショート(0H))

AC解析 - DC解析でバイアス点を求める。バイアス点周りで直線近似(偏微分)。曲線をなぞらない

TRAN解析 - 必要な時間までニュートンラプソン法を用いてシミュレーション

HB(ハーモニックバランス解析) - AC解析とTRAN解析の中間　該当周波数での定常動作状態をシミュレーション


# AD変換
ENOB - 有効ビット数(分解可能な最大ビット数)

MSB - 最上位ビット(most significiant bit)

***

## 各種ADC
<details>
<div>

アナログ入力の値を、あたかも物差しで測るように、一気にデジタル値に変換する。
変換最大電圧$V_{max}$と$GND$の間にコンパレータを入力し、アナログ入力値と大小比較をする。アナログ入力値が抵抗端子の出力よりも大きいときはコンパレータが1を出力し、反対にアナログ入力端子が小さいときは0を出力する。この方法でアナログ入力値を短時間でデジタル値に変換できる

| 変換時間 | 回路規模 | 消費電力 | 分解能 |
|:-------:|:--------:|:-------:|:-----:|
| 非常に短い | 大きい | 大きい | 小さい |

 ![FlashADC](/images/FlashADC.png)


</div>
<summary>
並列比較型ADC
</summary>
</details>
<details>
<div>

アナログ電圧がトラック/ホールド上で保持される。バイナリ探索アルゴリズムを実行するために、Nビットレジスタは最初に中間スケール(MSBを1にして他を0にする)に設定される。これによってDAC出力を$V_{ref}/2$に設定する。この後、$V_{in}$が$V_{DAC}$以下か以上であるかを決定するために比較がコンパレータで実行され、SAR制御ロジックにその結果で次のビットを設定して新たに比較を実行する

| 変換時間 | 回路規模 | 消費電力 | 分解能 |
|:-------:|:--------:|:-------:|:-------:|
|中程度   | 小さい   | 小さい   | 小さい |

![SARADC](/images/SARADC.png)

</div>
<summary>
逐次比較型（SAR）型ADC
</summary>
</details>


<details>  
<div>
一般的な1.5bit/ステージ構成の場合、MSBを決めるステージ1から順番にパイプライン動作で以下の処理を繰り返す
<dl>
<dd>アナログ入力を標本化(S/H)する</dd>
<dd>同時にアナログ入力をADCで3値(1.5bit)のデジタル値に変換</dd>

* アナログ入力$<=-V_{REF}/4$ -> D = "00"

* $-V_{REF}/4　<$アナログ入力 $<=V_{REF}/4$ -> D = "01"

* $V_{REF}/4 <$ アナログ入力 -> D = "10"

<dd>3値(1.5bit)のデジタル値をDACでアナログ値に変換</dd>
</dl>

* D = "00" -> DAC出力:$-V_{REF}/2$

* D = "01" -> DAC出力:$0$

* D = "10" -> DAC出力:$V_{REF}/2$

<dl>
<dd>標本化した電圧からDAC出力電圧を引いたものを二倍に増幅し次のステージへ出力</dd>
<dd>LSBを決めるステージNの処理が完了すると、各ステージ間の遅延を補正しそれぞれのデジタル出力を加算することで、デジタル信号への変換が完了する</dd>
</dl>

| 変換時間 | 回路規模 | 消費電力 | 分解能 |
|:-------:|:--------:|:-------:|:------:|
|長い     | 大きい    | 大きい   |  大きい| 

![pipelineADC](/images/pipelineADC.jpg)

</div>
<summary>
パイプライン型ADC
</summary>
</details>

<details>

<div>

入力信号の絶対振幅を記録するのではなく、信号振幅の変化を記録し、それを1bit量として保存する。

***
# 関連用語

## 信号伝達関数(STF) 雑音伝達関数(NTF)

## オーバーサンプリング比(OSR)
入力信号に対するサンプリング周波数とナイキスト周波数の比

***

1. ΔΣ変調

 * 4つの機能ブロックから構成されたシステムで実現される。入力信号の値とある固定電圧値の差を求める**Δ(減算)回路**、その減算した結果を次々に加えていく**Σ(加算)回路(または積分回路)**、加算結果をある値と比較して大小関係を見つける**量子化回路**、その量子化回路の出力(デジタル値)に応じて動作する**スイッチ回路**

 ![deltasigmaADC](/images/deltasigmaADC.png)

2. 高精度のための技術

 * ΔとΣの動作を一段だけでなく、もう一段追加すると変換精度が向上することがわかっている

 * ノイズシェーピング

 >オーバーサンプリングにより、量子化ノイズが測定対象周波数よりもずっと広い周波数レンジに分布する。この時量子化ノイズの挙動はガウスノイズに近く、サンプリング周波数の帯域内に一様なノイズレベルで現れる。一方量子化ノイズの総パワーは分布する周波数領域の広さによらず一定に保たれるため、ノイズをより広い帯域に分布させることは、測定対象周波数でのノイズレベルを低減させることにつながる


</div>
<summary>
ΔΣ型ADC
</summary>
</details>

***

## コヒーレントサンプリング
入力信号Vinとサンプリングクロックが一つのクロック信号により同期

単一の信号源から入力信号とサンプリングクロックを発生するためジッタに強い測定法

***

## ジッタ
サンプリングタイミングの変動により特性(SNR)が劣化すること

正弦波の周波数$f$が高いほどSNRは大きく劣化する


# CMOS入門
ソース接地増幅回路の電圧利得$A_{0}$は
$$A_{o} = v_{out}/v_{in} = -g_{m}R_{out}^{eff}$$
ただし
$$R_{out}^{eff} = [1/r_{on} + 1/r_{op}]^{-1}$$

出力端子に寄生する容量$C_{out}$と出力抵抗$R_{out}^{eff}$の大きい増幅回路ほど高周波数領域の信号を増幅することが苦手

ソース接地回路は入力許容範囲が狭いという問題があるため単体では使いづらい
入力電圧のレベル合わせを余り深刻に考えずに回路接続ができる方法が差動回路

参照電源回路にはカレントミラー回路が用いられる
出力電圧の下限を下げるために特殊な回路構成をとっている
参照電流源や電圧源はダイオード特性から作り出せる

増幅回路が十分大きな利得Aを持っていれば、利得の大きさによらず入力信号の$1/\beta_{F}$倍の値が出力される

帰還がない場合の増幅回路の周波数特性
$$A(s) = \frac{A_{0}}{1+\frac{s}{\omega_{p}}}$$
ここで、$\omega_{p}$は最小の遮断周波数で、利得は$\omega_{p}$以下の低周波側では一定、それ以上の高周波領域では$-20dB/dec$で低下することがわかる

帰還がある場合の増幅回路の周波数特性
$$A(s) = \frac{A_{0}}{1+A_{0}\beta_{f}}{\frac{1}{1+\frac{s}{\omega_{p}(1+A_{0}\beta_{f})}}}$$
低周波領域の利得は元の増幅回路の利得の$\frac{1}{1+A_{0}\beta_{f}}$倍になるが、遮断周波数は逆に$\omega_{p}(1+A_0\beta_{F})$にまで伸びる

帰還による利得の低下は増幅回路の多段接続で補う

opアンプにカスコード差動増幅回路を用いる - 入出力電圧範囲が狭い

折り返しカスコード差動増幅回路を用いると電圧利得が大きくなり、入出力電圧範囲も広くなるが動作に関与するMOSFETの数が大きいので占有面積が大きく、電流経路が増えたので消費電力が大きくなる

利得強化型カスコードは出力抵抗を増加させることで利得を大きくすることができる。しかし、高速性や消費電力に難点がある

***

<details>出力の100%を入力に戻す回路<summary>ユニティ・ゲイン・バッファ 
</details>
</summary>

ユニティ・ゲイン・バッファの過渡応答特性を考えると、応答特性から$p_1$と$p_2$の関係を、$$p_2=2A_0p_1$$程度にすることが望ましいことがわかる

$A_0$の大きなOPアンプの場合$p_1$を小さくしないと回路が発振してしまうことがわかる

そこでミラーキャパシタを加えることで極分離をさせ、$p_1$を低周波側に、$p_2$を高周波側にシフトする

# リングオシレーター
奇数個のインバータ回路を環状に接続することでインバータの伝搬遅延を利用して発振する発振回路である

# PLL(Phase Locked Loop)
入力される周期的な信号を元にフィードバック制御を加えて、別の発振器から位相が同期した信号を出力する電子回路

***

<div>
<details>

二つのアナログ入力と、一つのデジタル出力を持ち、アナログ入力$V_{in}$と参照電圧$V_{ref}$との大小関係を比較し、その結果を0,1で出力する

<summary>コンパレータ
</summary>
</deatils>
</div>

***

## オペアンプ設計

### オペアンプを構成する回路要素
バイアス回路、入力差動増幅段、利得段、出力バッファで構成される

差動入力段で要求されるもの
* 大きな入力電圧範囲
* 大きな利得
* 高い入力インピーダンス

カレントミラーは利得が30dB程度なので、オペアンプで要求される60dBには及ばない

そこで、カスコード差動増幅回路を用いるとこの要求を達成できる。
